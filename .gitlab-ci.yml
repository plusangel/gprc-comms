image: ubuntu:18.04

before_script:
  - apt-get install build-essential autoconf libtool pkg-config automake curl cmake
  - git clone -b $(curl -L https://grpc.io/release) https://github.com/grpc/grpc
  - cd grpc
  - git submodule update --init
 
  # Build and install protobuf
  - cd ./third_party/protobuf
  - ./autogen.sh
  - ./configure --prefix=/opt/protobuf
  - make -j `nproc`
  - make install
  
# Build and install gRPC
  - cd ../..
  - make -j `nproc` PROTOC=/opt/protobuf/bin/protoc 
  - make prefix=/opt/grpc install

build:
  script:
    - git clone https://angelos.p:$PASSWORD@gitlab.com/innotecuk/grpc-comms.git
    - cd grpc-comms/
    - mkdir -p build && cd build
    - cmake ..
    - make
